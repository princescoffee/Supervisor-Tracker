<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Princes' Coffee - Supervisor Tracker</title>
    <style>:root{--dark-green:#546141;--light-gray:#E2DEDA;--white:#FFFFFF}*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}body{background-color:var(--light-gray);display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px}.container{background:var(--white);border-radius:10px;padding:30px;box-shadow:0 4px 15px rgba(0,0,0,0.1);max-width:600px;width:100%}.logo{display:block;margin:0 auto 25px auto;max-width:250px;height:auto}h1,h2{color:var(--dark-green);margin-bottom:20px;text-align:center}input,select,textarea,button{width:100%;padding:12px;margin-bottom:15px;border:1px solid #ccc;border-radius:5px;font-size:16px}button{background-color:var(--dark-green);color:white;border:none;cursor:pointer;transition:background-color .3s;font-weight:700}button:disabled{background-color:#ccc;cursor:not-allowed}.status{padding:10px;border-radius:5px;margin-bottom:15px;text-align:center;font-weight:700}.clocked-in{background-color:#e8f5e9;color:#2e7d32}.clocked-out{background-color:#ffebee;color:#c62828}.location{background-color:#f1f1f1;padding:10px;border-radius:5px;margin-bottom:15px;font-size:.9em;color:#555}</style>
</head>
<body>
    <div class="container">
        <div id="loginSection" class="login-form">
            <img src="logo1.jpeg" alt="Princes Coffee Logo" class="logo">
                        <h1>Supervisor Tracker</h1>
            <input type="text" id="username" placeholder="Username" required> <input type="password" id="password" placeholder="Password" required>
            <button onclick="login()">Login</button> <p id="loginError" style="color: red; display: none;">Invalid credentials.</p>
        </div>
        <div id="dashboard" class="dashboard" style="display: none;">
            <img src="logo1.jpeg" alt="Princes Coffee Logo" class="logo">
             <h2>Welcome, <span id="userName"></span></h2>
            <div class="clock-section">
                <div id="clockStatus" class="status clocked-out">Status: Clocked Out</div> <div id="locationInfo" class="location">Location: Acquiring...</div>
                <select id="branchSelect"><option value="">Select Branch...</option></select> <button id="clockButton" onclick="toggleClock()">Clock In</button>
            </div>
            <div class="activity-form">
                <h2>Log Activity</h2> <textarea id="activityDescription" placeholder="Describe what you did during this visit..." rows="4"></textarea>
                <button id="activityButton" onclick="logActivity()">Save Activity Log</button>
            </div>
            <button onclick="logout()" style="background-color: #757575; margin-top: 30px;">Logout</button>
        </div>
    </div>
    <script>
        // THIS IS THE ONLY LINE YOU NEED TO CHANGE IN THIS FILE
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzWCXuitc1WhqJC06rQIn71ovN7FToKqHvLoc4itc09VHpH7Pt-Ze4TXcZbUOMmBtO1og/exec'; 

        const users={"sameh":"sam123","farid":"far123","emdad":"emd123","bilal":"bil123","abubakr":"abu123","manager5":"pass123","manager6":"pass123","manager7":"pass123","manager8":"pass123","manager9":"pass123","manager10":"pass123","manager11":"pass123","manager12":"pass123","manager13":"pass123","manager14":"pass123","manager15":"pass123"};
        const branches=[{code:'JD-12',name:'Rabua'},{code:'JD-18',name:'Hamdaniya'},{code:'JD-36',name:'Cobri Al Mouraba'},{code:'JD-37',name:'Corniche C6'},{code:'JD-44',name:'salihia'},{code:'JD-19',name:'Halaqa'},{code:'JD-23',name:'SASCO Madinah'},{code:'JD-48',name:'khulays'},{code:'JD-02',name:'Raheli - Makkah'},{code:'JD-04',name:'Jamaa'},{code:'JD-11',name:'Quresh'},{code:'JD-25',name:'Daham Jed'},{code:'JD-30',name:'Tahliya Mall'},{code:'MK-16',name:'Bahara1'},{code:'MK-40',name:'Bahra 2'},{code:'MK-47',name:'Hadda'},{code:'JD-03',name:'Sulemania'},{code:'MK-06',name:'Awali'},{code:'MK-13',name:'Showkiya'},{code:'MK-43',name:'Al Husainiah'},{code:'MK-41',name:'Hospital abdullah'},{code:'MK-28',name:'Arishi Taif'},{code:'MK-01',name:'Al Bouhayrat'},{code:'MK-39',name:'Al omra'},{code:'MK-17',name:'Koudai'},{code:'MK-49',name:'heraa'},{code:'MK-20',name:'Nawariya'},{code:'MK-15',name:'Jamoom'},{code:'MK-05',name:'Zaidi'},{code:'MK-32',name:'Al Nuzha'},{code:'MK-08',name:'Um Al Jood'},{code:'MK-14',name:'Jorana'},{code:'MK-21',name:'Al Sharaya'},{code:'MK-22',name:'Askar'},{code:'MK-45',name:'alsharayie alqadisia'},{code:'MK-07',name:'Kakia'},{code:'MK-46',name:'al Rusayfah'},{code:'TF-31',name:'Wisam - Taif'},{code:'TF-35',name:'Kotbiya AL Sharkiya-Taif'},{code:'TF-33',name:'Al Jeddeyah'},{code:'TF-38',name:'Al Sayl'},{code:'TF-42',name:'shehar'}];
        let currentUser=null,clockedIn=!1,currentLocation=null;
        window.onload=function(){populateBranches();const e=localStorage.getItem("currentUser");e&&(currentUser=e,showDashboard(),startTrackingLocation())};
        function login(){const e=document.getElementById("username").value.toLowerCase(),t=document.getElementById("password").value;users[e]&&users[e]===t?(currentUser=e,localStorage.setItem("currentUser",e),showDashboard(),startTrackingLocation()):document.getElementById("loginError").style.display="block"}
        function logout(){localStorage.clear(),window.location.reload()}
        function showDashboard(){document.getElementById("loginSection").style.display="none",document.getElementById("dashboard").style.display="block",document.getElementById("userName").textContent=currentUser,clockedIn="in"===localStorage.getItem(`${currentUser}_clockStatus`),updateClockUI()}
        function toggleClock(){const e=document.getElementById("clockButton");if(e.disabled=!0,e.textContent="Processing...",!clockedIn){const t=document.getElementById("branchSelect").value;if(!t)return alert("Please select a branch."),e.disabled=!1,void(e.textContent="Clock In");if(!currentLocation)return alert("Location not available. Please wait."),e.disabled=!1,void(e.textContent="Clock In");sendDataToGoogleSheet({username:currentUser,eventType:"Clock In",branch:getBranchFullNameByCode(t),latitude:currentLocation.latitude,longitude:currentLocation.longitude}),localStorage.setItem(`${currentUser}_clockStatus`,"in"),localStorage.setItem(`${currentUser}_clockInTime`,(new Date).toISOString()),localStorage.setItem(`${currentUser}_clockInBranchCode`,t),clockedIn=!0}else{const t=new Date,n=new Date(localStorage.getItem(`${currentUser}_clockInTime`)),o=localStorage.getItem(`${currentUser}_clockInBranchCode`),a=Math.round((t-n)/6e4);sendDataToGoogleSheet({username:currentUser,eventType:"Clock Out",branch:getBranchFullNameByCode(o),latitude:currentLocation?currentLocation.latitude:"N/A",longitude:currentLocation?currentLocation.longitude:"N/A",duration:a}),localStorage.removeItem(`${currentUser}_clockStatus`),localStorage.removeItem(`${currentUser}_clockInTime`),localStorage.removeItem(`${currentUser}_clockInBranchCode`),clockedIn=!1}updateClockUI(),e.disabled=!1}
        function logActivity(){if(!clockedIn)return void alert("You must be clocked in to log an activity.");const e=document.getElementById("activityDescription").value;if(!e.trim())return void alert("Please enter an activity description.");const t=document.getElementById("activityButton");t.disabled=!0,t.textContent="Saving...";const n=localStorage.getItem(`${currentUser}_clockInBranchCode`);sendDataToGoogleSheet({username:currentUser,eventType:"Activity Log",branch:getBranchFullNameByCode(n),latitude:currentLocation?currentLocation.latitude:"N/A",longitude:currentLocation?currentLocation.longitude:"N/A",description:e}),document.getElementById("activityDescription").value="",alert("Activity logged successfully!"),t.disabled=!1,t.textContent="Save Activity Log"}
        function updateClockUI(){const e=document.getElementById("clockStatus"),t=document.getElementById("clockButton"),n=document.getElementById("branchSelect");clockedIn?(n.value=localStorage.getItem(`${currentUser}_clockInBranchCode`),e.textContent=`Status: Clocked In at ${getBranchNameByCode(n.value)}`,e.className="status clocked-in",t.textContent="Clock Out",n.disabled=!0):(e.textContent="Status: Clocked Out",e.className="status clocked-out",t.textContent="Clock In",n.value="",n.disabled=!1)}
        function populateBranches(){const e=document.getElementById("branchSelect");branches.sort((e,t)=>e.name.localeCompare(t.name)),branches.forEach(t=>{const n=document.createElement("option");n.value=t.code,n.textContent=`${t.code} - ${t.name}`,e.appendChild(n)})}
        function getBranchNameByCode(e){const t=branches.find(t=>t.code===e);return t?t.name:"Unknown Branch"}
        function getBranchFullNameByCode(e){const t=branches.find(t=>t.code===e);return t?`${t.code} - ${t.name}`:"Unknown Branch"}
        function startTrackingLocation(){navigator.geolocation.watchPosition(e=>{currentLocation={latitude:e.coords.latitude,longitude:e.coords.longitude},document.getElementById("locationInfo").textContent=`Location: ${currentLocation.latitude.toFixed(5)}, ${currentLocation.longitude.toFixed(5)}`},()=>{document.getElementById("locationInfo").textContent="Error: Please enable location services."},{enableHighAccuracy:!0})}
        function sendDataToGoogleSheet(e){if(!SCRIPT_URL||SCRIPT_URL.includes("YOUR_URL_HERE"))return void alert("CRITICAL ERROR: URL not configured.");fetch(SCRIPT_URL,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).catch(e=>console.error("Data sent (this error is expected with no-cors):",e))}
    </script>
</body>
</html>

